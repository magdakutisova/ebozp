<?php echo $this->filters()?>

<div class="box" id="filtered">
<a name="up"></a>
<a href="#down">&#x25BC; Dolů &#x25BC;</a>

	<?php $client = "";
	$companyName = "";
	$companyAddress = "";
	$clientId = "";
	$allowed = ""?>
	<ul>
	<?php foreach ($this->subsidiaries as $subsidiary) :
	if($subsidiary->getHq()){
		if($allowed){ ?>
		</ul>
		<p class="bold">
			<a href="<?php echo $this->url(array('clientId' => $clientId), 'clientIndex')?>"><?php echo $companyName; ?> - <?php echo $companyAddress; ?></a>
		</p>
		<ul>
		<?php }
		$companyName = $subsidiary->getSubsidiaryName();
		$companyAddress = $subsidiary->getSubsidiaryStreet() . ', ' . $subsidiary->getSubsidiaryTown();
		$clientId = $subsidiary->getClientId();
		$allowed = $subsidiary->getAllowed();
		continue;
	}
	if($subsidiary->getAllowed()){
		if ($client != $subsidiary->getClientId()){?>
			</ul>
			<?php $client = $subsidiary->getClientId(); ?>
			<p class="bold concealer">
			<?php if($allowed){?><a><?php }?>
				<span class="anchor"><?php echo $companyName . ' - ' . $companyAddress ?></span>
			<?php if($allowed){?></a><?php }?>
			</p>
			<ul class="hidden">
			<?php if ($allowed){
			echo '<li><a href="' . $this->url(array('clientId' => $clientId), 'clientIndex') . '">' . $companyName . ' - ' . $companyAddress . ' (centrála)</a>';
			$allowed = ''; }?>
		<?php } ?>
		<li><?php echo '<a href="' . $this->url(array('clientId' => $subsidiary->getClientId(), 'subsidiary' => $subsidiary->getIdSubsidiary()), 'subsidiaryIndex') . '">' . $subsidiary->getSubsidiaryName() . ' - ' . $subsidiary->getSubsidiaryStreet() . ', ' . $subsidiary->getSubsidiaryTown() . '</a>'?></li>
	<?php }
		endforeach; ?>
	</ul>	
	
<a name="down"></a>
<a href="#up">&#x25B2; Nahoru &#x25B2;</a>		
	
</div>