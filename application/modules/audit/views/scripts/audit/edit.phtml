<?php 
echo $this->formHidden("auditId", $this->audit->id);
echo $this->formHidden("clientId", $this->client->id_client);
?>
<h1>Audit</h1>
<h2><?php echo $this->client->company_name . " - " . $this->subsidiary->subsidiary_name; ?></h2>
<div id="tabs">
	<ul>
		<li><a href="#overview">Přehled</a></li>
		<li><a href="#forms">Formuláře</a></li>
		<li><a href="#mistakes">Neshody</a></li>
	</ul>
	<div id="overview" class="tab">
		<h3>Přehled</h3>
		<?php
		echo $this->form;
		?>
		<em>*)Shrnutí musí být vyplněno než bude audit uzavřen a odeslán koordinátorovi</em>
		<?php 
		// vyhodnoceni zobrazeni uzavreni auditu
		if ($this->form->getElement("summary")->getValue()) {
			?>
		<h3>Uzavření auditu</h3>
			<?php 
			echo $this->submitForm;
		}
		?>
	</div>
	<div id="forms" class="tab">
		<h3>Formuláře</h3>
		<table>
			<thead>
				<tr>
					<th>
					Formulář
					</th>
					<th>
					Skóre
					</th>
				</tr>
			</thead>
			<tbody>
		<?php 
		$params = array(
				"clientId" => $this->client->id_client,
				"subsidiaryId" => $this->subsidiary->id_subsidiary,
				"auditId" => $this->audit->id
		);
		
		foreach ($this->formInstances as $instance) {
			$params["formId"] = $instance->id;
			
			$href = $this->url($params, "audit-form-fill");
			
			?>
				<tr>
					<td>
					<a href="<?php echo $href; ?>"><?php echo $instance->name; ?></a>
					</td>
					<td>
					<?php echo $instance->score; ?>
					</td>
				</tr>
			<?php 
		}
		?>
			</tbody>
		</table>
		<?php echo $this->instanceForm; ?>
	</div>
	<div id="mistakes" class="tab">
		<h3>Neshody</h3>
		<table id="table-mistakes" class="multirow-table">
			<?php 
			$this->mistakeTable()->workIndex = $this->workIndex;
			
			echo $this->mistakeTable()->header();
			
			foreach ($this->mistakes as $mistake) {
				echo $this->mistakeTable()->mistake($mistake, array("edit-mistake" => "Upravit"));
			}
			?>
		</table>
		<?php 
		// vytvoreni neshody mimo dotaznik
		$url = $this->url(array("clientId" => $this->audit->client_id, "auditId" => $this->audit->id), "audit-mistake-createalone1");
		
		echo "<div class='box'><a href='$url'>Přidat neshodu mimo dotazník</a></div>";
		?>
	</div>
</div>
<script type="text/javascript" src="/js/audit/audit/edit.js"></script>