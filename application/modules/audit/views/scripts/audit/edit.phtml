<?php 
echo $this->formHidden("auditId", $this->audit->id);
echo $this->formHidden("clientId", $this->client->id_client);
?>
<?php echo $this->auditInfo()->header($this->audit, $this->client, $this->subsidiary); ?>
<div id="tabs">
	<ul>
		<li><a href="#overview">Přehled</a></li>
		<li><a href="#forms">Formuláře</a></li>
		<li><a href="#mistakes">Neshody</a></li>
		<li><a href="#newmistake">Nová neshoda</a></li>
	</ul>
	<div id="overview" class="tab">
		<h3>Přehled</h3>
		<?php
		echo $this->form;
		?>
		<em>*)Shrnutí musí být vyplněno než bude audit/prověrka uzavřena a odeslána koordinátorovi</em>
		<?php 
		// vyhodnoceni zobrazeni uzavreni auditu
		if ($this->form->getElement("summary")->getValue()) {
			?>
		<h3>Uzavření auditu</h3>
			<?php 
			echo $this->submitForm;
		}
		?>
	</div>
	<div id="forms" class="tab">
		<h3>Formuláře</h3>
		<table>
			<thead>
				<tr>
					<th>
					Formulář
					</th>
					<th>
					Skóre
					</th>
				</tr>
			</thead>
			<tbody>
		<?php 
		$params = array(
				"clientId" => $this->client->id_client,
				"subsidiaryId" => $this->subsidiary->id_subsidiary,
				"auditId" => $this->audit->id
		);
		
		foreach ($this->formInstances as $instance) {
			$params["formId"] = $instance->id;
			
			$href = $this->url($params, "audit-form-fill");
			
			?>
				<tr>
					<td>
					<a href="<?php echo $href; ?>"><?php echo $instance->name; ?></a>
					</td>
					<td>
					<?php echo $instance->score; ?>
					</td>
				</tr>
			<?php 
		}
		?>
			</tbody>
		</table>
		<?php echo $this->instanceForm; ?>
	</div>
	<div id="mistakes" class="tab">
		<h3>Neshody zahrnuté v <?php echo $this->audit->is_check ? "prověrce" : "auditu"; ?></h3>
		<table id="table-mistakes" class="multirow-table">
			<?php 
			$this->mistakeTable()->workIndex = $this->workIndex;
			
			echo $this->mistakeTable()->header();
			
			foreach ($this->mistakes[0] as $mistake) {
				// vyhodnoceni semaforu
				if ($mistake->is_removed) {
					$semaphore = 0;
				} elseif ($mistake->is_marked) {
					$semaphore = 2;
				} else {
					$semaphore = 1;
				}
				
				echo $this->mistakeTable()->mistake($mistake, array("actions" => array("edit-mistake" => "Upravit"), "semaphore" => $semaphore));
			}
			?>
		</table>
		<h3>Neshody z jinch auditů a prověrek</h3>
		<table id="table-mistakes" class="multirow-table">
			<?php 
			$this->mistakeTable()->workIndex = $this->workIndex;
			
			echo $this->mistakeTable()->header();
			
			foreach ($this->mistakes[1] as $mistake) {
				echo $this->mistakeTable()->mistake($mistake, array("actions" => array("edit-mistake" => "Upravit")));
			}
			?>
		</table>
		<p>
			<?php echo $this->formButton("save-mistakes", "Uložit změny"); ?>
		</p>
	</div>
	<div id="newmistake">
	<?php 
	echo $this->selectWorkplace;
	?>
	</div>
</div>
<script type="text/javascript" src="/js/audit/audit/edit.js"></script>